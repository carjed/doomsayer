```{r dist, message=FALSE, warning=FALSE, echo=FALSE, fig.height = 10, fig.width = 10, dpi=100}

# get_leaves_branches_col(hrm$rows)

# overall distribution
spectra2 <- left_join(spectra, cluster_mems, by="ID") %>% 
  replace_na(list(group="keep")) %>% 
  # mutate(group=ifelse(ID %in% keep_ids$V1, "keep", "drop")) %>%
  group_by(group) %>%
  gather(subtype, count, 2:ncol(spectra)) %>%
  separate(subtype, c("category", "motif"), sep = "[.]") %>%
  mutate(category=gsub("_", ">", category)) %>%
  mutate(category=factor(category, levels=orderedcatsnc_short)) %>%
  group_by(category, motif, group) %>%
  summarise(count=sum(count)) %>%
  group_by(group) %>%
  mutate(prop=count/sum(count)) %>%
  ungroup()

p <- ggplot(spectra2, aes(x=motif, y=prop, fill=group, group=group))+
  geom_bar(stat="identity", position="dodge")+
  facet_wrap(~category, ncol=1, scales="free")+
  # facet_grid(category~.)+
  ylab("Contribution")+
  # scale_fill_brewer(palette = "Set1")+
  scale_fill_manual(values=c("#D3D3D3", group_col_vals))+
  theme_bw()+
  theme(axis.text.x=element_text(angle=90, vjust=0, size=10),
        # axis.text.y=element_text(size=20),
        # axis.title.x=element_text(size=24),
        # axis.title.y=element_text(size=24),
        # legend.text=element_text(size=20),
        # strip.text=element_text(size=24),
        legend.title=element_blank(),
        legend.position="bottom")
   
sggplotly(p)

```
